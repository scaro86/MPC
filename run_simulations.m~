% Init
clear all
close all
addpath(genpath(cd));
load('system/parameters_scenarios.mat');

param = compute_controller_base_parameters;
%% Exercise 5: execute simulation with LQR
% clear persisten variables of function controller_lqr
clear controller_lqr; 
% execute simulation starting from T0_1 using lqr controller with scenario 1
x0_1 = [3; 1; 0];
T0_1 = param.T_sp + x0_1;
[T, p] = simulate_truck(T0_1, @controller_lqr, scen1);
% check if the reference is approached reasonably fast
dist = abs(param.T_sp - T(30))
if dist > 0.2*x0_1
    disp('your control is too slow')
else
    disp('your control is perfect')
end
%% Exercise 6: Compute the infinite horizon cost under the LQR control law
[K,~,] = dlqr(param.A,param.B,param.Q,param.R);
costlqr = compute_cost(x0_1,param.A-param.B*K,K,param.Q,param.R,1000);
fprintf('Cost of the optimal LQR controller: %.2f\n',costlqr);